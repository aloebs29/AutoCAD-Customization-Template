# AutoCAD-Customization-Template
Starting template for writing AutoCAD customization software using AutoLISP and the AutoCAD .NET API.

## The problem
Custom AutoLISP files and .NET assemblies can be loaded every time you (or another user) opens a new drawing by placing the load commands within the acaddoc.lsp file. However, only one acaddoc.lsp file is loaded, so every customization suite must add their commands to the same document (which likely means your users will have to go into the acaddoc.lsp themselves and add your load commands). I have also come accross customization suites which define their own acaddoc.lsp file. Assuming AutoCAD finds this acaddoc file first, it will load this customization suite and quit looking for other acaddoc files. Assuming it doesn't find this acaddoc first, the custom commands will not be loaded.

## A solution
To solve this, I create a new partial customization file (.cuix) for each customization suite I create and have users add this customization file to their AutoCAD by using the "CUI" command. When AutoCAD opens a new drawing, it searches for a ".mnl" file with the same name as this customization file, and executes the AutoLISP within that file. I could just load all of my lisp files and assemblies from there, but instead I load a seperate "LoadOnStartup.lsp" and call the main function within that file to load everything. This is done to make it more obvious where one needs to go to edit what gets loaded on startup (in case another developer edits or adds to what I've done at some point).

## How to use this template
Once you have downloaded or cloned this repo, go to AutoCAD, type in "options" and hit enter, and then add the "AutoCAD-Customization-Template" folder to your support file search paths, as well as your trusted file locations. Next, type in "cui" and hit enter, scroll down to "Partial Customization Files" in the left hand pane, right click, and select "Load partial customization file". Navigate to the "CUI_Template.cuix" file within the "AutoCAD-Customization-Template" folder, and select this file to load into AutoCAD. Click the "OK" button to apply the changes and exit the "Customize User Interface" dialog.

At this point, you should see AutoCAD asking if you want to load the AutoLISP files and .NET assemblies I've included in the template. Select the "Always load" option for each of them. Now you should be able to execute the commands "HELLOAUTOLISP", "HELLOCUSTOMLISP", and "HELLOCOMMANDMETHOD".

## Load on startup
Within this file you can find commands which load each .NET assembly I've included in this template, as well as every .lsp file within the "Lisp" folder. The comments within the "LoadOnStartup.lsp" file explain why I've done things in this manner.

## NetReload
Net reload is a tool developed by the user "Artvegas" on the Autodesk forums. You can find a link to the post where he shares the motivation, source, and assembly here: https://forums.autodesk.com/t5/net/net-reload-utility-for-visual-studio-download-here/td-p/3185104. This command allows you to reload your .NET projects within AutoCAD after you've made changes to your source. Without this, you'd have to close AutoCAD every time you had loaded a .NET assembly and wanted to unload it, rebuild, and reload it. I have a version of the source with the necessary references and dependencies within the "Dotnet/NetReload" folder if you want to open it up and make changes, or if you find that the assembly I've included in the "Assemblies/NetReload" folder doesn't work with your version of AutoCAD. 

If you do open this or any of the other .NET projects within visual studio, you will probably have broken references to the "AcCoreMgd", "AcDbMgd", and "AcMgd" assemblies. To fix this, simply right click "References" and select "Add Reference". Navigate to the "Browse" tab on the left hand side, and select the "Browse" button in the bottom right of the dialog. Navigate to your AutoCAD installation, and within the main folder (AutoCAD 20XX, which also holds your acad.exe) you should find the three DLLs mentioned above. The "Browse" button will add these assemblies to your reference manager, but will not add these references to your project. To add these references to your project, select them within the "Reference Manager" dialog (a check mark should appear to the left of them), and click "OK" to apply the changes and exit the dialog.

If you're having trouble with this a much more in-depth explanation can be found on Autodesk's website. They have very good documentation for AutoLISP, the AutoCAD .NET API, as well as their other customization toolchains. The AutoCAD 2019 version of this documentation can be found here: https://help.autodesk.com/view/OARX/2019/ENU/

## Hello commands
I've included three template commands. "HELLOCOMMANDMETHOD" is a command defined within a .NET assembly. You can find the source within the "Dotnet/CommandMethodTemplate" folder. "HELLOAUTOLISP" is a command defined using simple AutoLISP. You can find the source within the "Lisp" folder in the file "HelloAutoLisp.lsp". "HELLOCUSTOMLISP" is a command defined using AutoLISP, which calls a custom lisp function defined within a .NET assembly. You can find the source for the custom lisp function within the "Dotnet/LispFunctionTemplate" folder. You can find the source for the lisp command which calls this function within the "Lisp" folder in the file "HelloCustomLisp.lsp".
